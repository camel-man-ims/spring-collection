# 섹션 7 - 빈 후처리기

## 1. 빈후처리기란?

### 1-1) Bean 후처리기 설명

<img width="569" alt="image" src="https://user-images.githubusercontent.com/51740388/190833477-d733edbb-b6ad-45b4-9dca-16ccc0c06022.png">

<img width="567" alt="image" src="https://user-images.githubusercontent.com/51740388/190833478-16130cf5-24f2-4070-ba7b-d84b7499b917.png">

* Spring Container에 등록되기 이전에 Bean에 대해서 후처리 작업을 할 수 있는 객체이다.
* 작업 흐름
    * Spring은 Bean 대상이 되는 객체를 생성한다.
    * Bean 저장소에 등록하기 이전에,Bean 후처리기에 객체를 전달한다.
    * Bean 후처리기는 Spring Container에 해당 객체를 전달한다.
        * 이때, 객체를 조작할 수도 있고, 그대로 전달할 수도 있다.

### 1-2) 코드

* [일반적인 Bean 등록](../src/test/java/hello/postprocessor/BasicTest.java)
* [A Bean을 B로 조작해서 등록](../src/test/java/hello/postprocessor/BeanPostProcessorTest.java)
    * B 객체가 Spring Bean으로 등록된다.

* Bean 후처리기를 사용하려면 `BeanPostProcessor` 인터페이스를 implements한 객체를 스프링 빈으로 등록하면 된다.
* 메서드 설명
    * `postProcessBeforeInitialization`
    * `postProcessAfterInitialization`
        * `Before`는 `@PostConstruct` 와 같이 초기화가 발생하기 전에, `After`는 `@PostConstruct`와 같이 초기화가 발생한 이후에 호출되는 포스트 프로세서이다.
* Bean 후처리기는 Bean을 조작하고 변경할 수 있는 후킹 포인트이다.
* 이 말은, **Bean 객체를 Proxy로 교체**하는 것도 가능하다는 말이다.
* 스프링도 내부의 기능을 확장하기 위해 내부적으로 Bean 후처리기를 사용한다.

## 2. Bean 후처리기를 v1,v2,v3에 적용

### 2-1) 코드

* [PackageLogTracePostProcessor: 빈후처리기](../src/main/java/hello/proxy/config/v4_postprocessor/PackageLogTracePostProcessor.java)
* [PackageLogTracePostProcessor Configuration 등록](../src/main/java/hello/proxy/config/v4_postprocessor/BeanPostProcessorConfig.java)

### 2-2) 코드 설명

<img width="560" alt="image" src="https://user-images.githubusercontent.com/51740388/190836553-58539852-d16a-4970-9b3c-5a419c40dbbd.png">

* `PackageLogTracePostProcessor`
    * `BeanPostProcessor` 를 상속받은 빈 후처리기다.
    * 해당 로직의 위쪽에 log를 찍어보면 Spring의 모든 Bean이 넘어오는 것을 알 수 있다.
        * 그렇기 때문에, basePackage를 지정해서 Proxy를 등록할 Bean만 지정해줘야 한다.
        * 만약 그렇지 않다면, Spring Boot가 기본으로 제공하는 Bean 중에는 Proxy를 등록할 수 없는 Bean들도 있기 때문에 에러가 발생한다.