# 섹션1) 예제만들기 - 로그 추적기

<!-- TOC -->

- [섹션1 예제만들기 - 로그 추적기](#%EC%84%B9%EC%85%981-%EC%98%88%EC%A0%9C%EB%A7%8C%EB%93%A4%EA%B8%B0---%EB%A1%9C%EA%B7%B8-%EC%B6%94%EC%A0%81%EA%B8%B0)
        - [-1 목표](#-1-%EB%AA%A9%ED%91%9C)
        - [-2 폴더 구조](#-2-%ED%8F%B4%EB%8D%94-%EA%B5%AC%EC%A1%B0)

<!-- /TOC -->


### 1-1) 목표

```
[c80f5dbb] OrderController.request()
[c80f5dbb] |-->OrderService.orderItem()
[c80f5dbb] |   |-->OrderRepository.save()
[c80f5dbb] |   |<--OrderRepository.save() time=1005ms
[c80f5dbb] |<--OrderService.orderItem() time=1014ms
[c80f5dbb] OrderController.request() time=1017ms
```

위와 같은 로깅 시스템을 만드는 것이 목표다.

### 1-2) 폴더 구조

```
.
├── main
│   ├── generated
│   ├── java
│   │   └── hello
│   │       └── advanced
│   │           ├── AdvancedApplication.java
│   │           ├── app
│   │           │   ├── v0
│   │           │   │   ├── OrderControllerV0.java
│   │           │   │   ├── OrderRepositoryV0.java
│   │           │   │   └── OrderServiceV0.java
│   │           │   ├── v1
│   │           │   │   ├── OrderControllerV1.java
│   │           │   │   ├── OrderRepositoryV1.java
│   │           │   │   └── OrderServiceV1.java
│   │           │   └── v2
│   │           │       ├── OrderControllerV2.java
│   │           │       ├── OrderRepositoryV2.java
│   │           │       └── OrderServiceV2.java
│   │           └── trace
│   │               ├── TraceId.java
│   │               ├── TraceStatus.java
│   │               └── hellotrace
│   │                   ├── HelloTraceV1.java
│   │                   └── HelloTraceV2.java
│   └── resources
│       ├── application.properties
│       ├── static
│       └── templates
└── test
    └── java
        └── hello
            └── advanced
                ├── AdvancedApplicationTests.java
                └── trace
                    └── hellotrace
                        ├── HelloTraceV1Test.java
                        └── HelloTraceV2Test.java
```

* v0
	* 로깅 적용 전
* v1
	* trace 하위 폴더에 로깅을 추적할 수 있는 `HelloTraceV1`을 생성하고 해당 코드를 사용하여 각 layer의 중간중간에 로깅을 추가
	* `HelloTraceV1` 의 경우
		* 복잡해 보이는데, 별 거 없다. 그냥 String 일일히 앞에 붙여준 것뿐
	* 대충 로깅이 적용되나, 각 level별로 depth적용이 안됐고, 다른 layer에 들어가면 thread 이름이 바뀐다.
* v2
	* v1을 보완한 버전
	* 각 level별로 depth 적용, 다른 layer에 들어가도 thread 이름 유지
	* `HelloTraceV2` 에 `beginSync` 라는 함수 만들어서 이전 레벨을 받게 만듬
		* `beginSync`
			* `TraceId` 객체의 `createNextId()` 함수를 이용하여 depth를 1씩 증가시킨다.